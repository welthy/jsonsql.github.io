<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>图片压缩</title>
    <style>
        body { margin: 0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Microsoft Yahei", sans-serif; background: #0b0f19; color: #e6e8ee; }
        .wrap { padding: 16px; display: grid; gap: 12px; }
        input[type=file] { border: 1px solid #1b2336; border-radius: 10px; padding: 8px; background: #0f1422; color: #e6e8ee; }
        .row { display: flex; gap: 8px; align-items: center; }
        button { height: 34px; padding: 0 12px; border-radius: 8px; border: 1px solid #1b2336; background: #3b82f6; color: #fff; cursor: pointer; }
        img { max-width: 100%; border-radius: 8px; }
        .hint { color: #a7adbd; font-size: 12px; }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="row">
            <input id="file" type="file" accept="image/*">
            <label>质量 <input id="quality" type="range" min="0.1" max="1" step="0.05" value="0.7"></label>
            <button id="do">压缩</button>
            <span id="meta" class="hint">—</span>
        </div>
        <img id="preview" alt="预览" />
        <a id="download" download="compressed.jpg" style="display:none">下载压缩图像</a>
    </div>
    <script>
        const el = (id) => document.getElementById(id);
        let originalBlob = null;
        el('file').onchange = async (e) => {
            const f = e.target.files[0]; if (!f) return;
            originalBlob = f;
            el('preview').src = URL.createObjectURL(f);
            el('meta').textContent = `原图大小: ${(f.size/1024).toFixed(1)} KB`;
        };
        el('do').onclick = async () => {
            if (!originalBlob) return alert('请选择图片');
            const img = new Image();
            img.src = URL.createObjectURL(originalBlob);
            await img.decode();
            const canvas = document.createElement('canvas');
            canvas.width = img.naturalWidth; canvas.height = img.naturalHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            const q = parseFloat(el('quality').value);
            canvas.toBlob((blob) => {
                if (!blob) return alert('压缩失败');
                el('preview').src = URL.createObjectURL(blob);
                el('meta').textContent += ` ｜ 压缩后: ${(blob.size/1024).toFixed(1)} KB`;
                const a = el('download');
                a.href = URL.createObjectURL(blob);
                a.style.display = '';
            }, 'image/jpeg', q);
        };
    </script>
</body>
</html>


